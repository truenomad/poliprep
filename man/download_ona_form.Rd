% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/get_ona_v2.R
\name{download_ona_form}
\alias{download_ona_form}
\title{Download ONA Form Data}
\usage{
download_ona_form(
  form_id,
  token = NULL,
  base_url = "https://api.whonghub.org/api/v1/data",
  page_size = 10000L,
  output_path = NULL,
  use_qs = FALSE,
  quiet = FALSE
)
}
\arguments{
\item{form_id}{Integer. The ONA form ID to download.}

\item{token}{Character. ONA API token. If NULL, reads from \code{ONA_API_TOKEN}
environment variable.}

\item{base_url}{Character. API base URL. Default is whonghub API.}

\item{page_size}{Integer. Number of records per page. Default 10000.}

\item{output_path}{Character or NULL. If provided, saves the result as an
RDS file (or QS2 if \code{use_qs = TRUE}) to this path.}

\item{use_qs}{Logical. Use \code{qs2} package for faster serialization. Default
FALSE (uses base \code{saveRDS}).}

\item{quiet}{Logical. Suppress progress messages. Default FALSE.}
}
\value{
A tibble containing the flattened form data. Returns NULL invisibly
if no data is available.
}
\description{
Fetches data from the ONA API (whonghub) with automatic pagination,
flattens nested JSON structures, and optionally saves to disk.
}
\section{Authentication}{

Requires an ONA API token. Set via the \code{ONA_API_TOKEN} environment variable
or pass directly to the \code{token} parameter. Environment variable takes
precedence if \code{token} is NULL.
}

\section{GPS Parsing}{

If columns named \code{GPS_hh} or \code{GPS_hh_end} exist, they are automatically
split into latitude, longitude, altitude, and precision components with
prefixed column names (e.g., \verb{_GPS_hh_latitude}).
}

\examples{
\dontrun{
# set token in environment
Sys.setenv(ONA_API_TOKEN = "your_token_here")

# download a single form
data <- download_ona_form(form_id = 8588)

# download and save to file
download_ona_form(
  form_id = 8588,
  output_path = "data/form_8588.rds"
)
}
}

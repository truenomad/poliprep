% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/get_ona.R
\name{flatten_ona_record}
\alias{flatten_ona_record}
\title{Flatten a Single ONA Submission into Wide Key-Value Pairs}
\usage{
flatten_ona_record(x, parent_key = "", sep = "/")
}
\arguments{
\item{x}{A named list representing a single ONA submission parsed from
JSON with \code{simplifyDataFrame = FALSE}.}

\item{parent_key}{A character string representing the accumulated key
path during recursion. Used internally. Default is an empty string.}

\item{sep}{A character string used to separate nested field names.
Default is \code{"/"}.}
}
\value{
A named list where each element corresponds to a flattened field.
All values are returned as character strings.
}
\description{
Recursively flattens a nested ONA JSON record into a named list of
character values using wide expansion. Nested objects are converted
into slash-separated keys, and repeat groups (lists) are expanded
horizontally using indexed column names (e.g. \verb{[1]}, \verb{[2]}).
}
\details{
The function preserves one row per submission. No row-level unnesting
occurs. All values are coerced to character for downstream consistency.

A special rule is applied to fields ending in \code{Count_HH}. For these,
the separator is not re-applied when descending into children. This
prevents duplicated key paths when flattening household count repeat
groups commonly found in ONA forms.

Flattening rules:
\itemize{
\item Nested objects are flattened using \code{sep} to join keys.
\item Lists are expanded into indexed columns using \verb{[i]} notation.
\item Lists do not create new rows.
\item Data frames are treated as atomic and not recursed.
\item All values are coerced to character.
}

This function is intended to be applied immediately after parsing ONA
API responses and before converting to a data frame.
}
\examples{
\dontrun{
raw <- jsonlite::fromJSON("ona_response.json", simplifyDataFrame = FALSE)
flat <- flatten_ona_record(raw[[1]])
as.data.frame(flat, stringsAsFactors = FALSE)
}

}
\seealso{
\code{\link{get_ona_page}} for usage in paginated downloads.
}
